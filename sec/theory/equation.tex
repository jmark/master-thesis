\subsection{Governing equations}

\paragraph{Ideal Magneto-Hydrodynamic Equations}
The magneto-hydrodynamic equations (MHD) are a corner stone of theoretical
astrophysics.  They model the fluid mechanics of ionized interstellar media in
an idealized form. In CGS unit they read as follows.

\begin{align}
\partial_t\dens + \nabla \cdot (\dens\,\velv)   &=  0 \\
\dens\, \partial_t \velv + \dens(\velv \cdot \nabla) \velv + \nabla \pres &= \frac{\curdensv \times \magdensv}{c} + \dens \vec{g} + \vec{F} \\
\nabla \times \magdensv &= \frac{4\;\pi}{c} \curdensv \\
\nabla \times \elefield &= -\frac{1}{c} \partial_t \magdensv \\
\nabla \cdot  \magdensv &= 0 \\
\curdensv               &= \sigma \left ( \elefield + \frac{\velv \times \magdensv}{c} \right )
\end{align}

TODO: Explain above equations in detail. Name -> physical meaning ...

We want to keep the simulation simple and do not include electric current
($\sigma = \infty$) and gravity in our model. Hence, $\curdensv = 0$ and
$\vec{g} = 0$. This simplifies above equations to the ideal MHD equations.
They are valid for dynamics in interstellar clouds where we have huge
spatial dimensions of several parsecs and consequently long crossing times.

TODO: More arguments why ideal MHD equations are valid for ISM simulations

TODO: Insert ideal MHD equations

When we set the initial magnetic field strength to zero $\magdensv = 0$ no
magnetic dynamics come into play and the equations reduces further to the
compressible Euler equations.

\paragraph{Compressible Euler Equations}

%% euler quation primitive form

%% \begin{align}
%% \label{eq:comp-euler}
%% \partial_t\dens + \nabla \cdot (\dens\,\velv)   &=  0 \\
%% \dens\, \partial_t \velv + \dens(\velv \cdot \nabla) \velv + \nabla \pres &= \vec{F} \\
%% \partial_t \ener + \nabla \cdot (\ener\,\velv - ...)   &=  0,
%% \end{align}

The compressible Euler Equations are valid for perfect fluids.  We assume no
heat conduction ($\SET^{i0} = \SET^{0i} = 0$), no viscosity ($\SET^{ij} =
p\,\mathbb{1}$, $\mu_d = 0$) and no gravity $g = 0$. Within in the comoving frame the
\emph{stress-energy tensor} $\SET$ reads:
\begin{equation}
\SET^{\alpha\beta} = \text{diag}(\dens\sndsped^2,\pres,\pres,\pres) = \left(\dens + \frac{\pres}{\sndsped^2}\right) \vels^\alpha\vels^\beta + p\,\mathbb{G}^{\alpha\beta}
\end{equation}
In the flat spacetime the \emph{metric tensor} is set to $\mathbb{G} = \text{diag}(-1,1,1,1)$. The total energy
and the number of particles are conserved.
\begin{align}
\partial_\nu \SET^{\mu\nu}  &= 0\\
\partial_\mu (n\,\vels^\mu) &= 0
\end{align}
Taking the non-relativistic limit, we arrive at the well-known Euler equations in conservative
form.
\begin{align}
\label{eq:comp-euler}
\partial_t\dens + \nabla \cdot (\dens\,\velv)   &=  0 \;\;\text{(mass cons.)}\\[0.4cm]
\partial_t(\dens\,\velv) + \nabla\cdot(\dens\velv\velv^T) + \nabla \pres &= \vec{F}  \;\;\text{(momentum cons.)}\\[0.4cm]
\partial_t \Ener + \nabla \cdot (\velv\,(\ener + \pres)) &=  0\;\;\text{(energy cons.)},
\end{align}
where the total energy $\Ener$ is composed of the internal energy $\Eint$ and
the kinetic energy $\Ekin$.
\begin{equation}
\Ener = \Eint + \Ekin = \frac{\pres}{\gamma -1} + \frac{\dens}{2}\vels^2
\end{equation}
The source term $\vec{F}$ allows us to perpetually inject a force field which gets important in the
discussion of driven turbulence later on.

\paragraph{Equation of State}
If not stated otherwise all simulations follow the \emph{ideal gas law}.
\begin{equation}
\pres = \frac{\sndsped^2}{\gamma} \, \dens = R\,T\,\dens = \frac{R}{c_v} \Eint = (\gamma - 1) \Eint,
\end{equation}
where $R$ is the specific ideal gas constant, $T$ is the gas temperature and $c_v
= \frac{\gamma - 1}{R}$ is the specific heat capacity at constant volume. The speed of sound $\sndsped$
is a direct consequence of the ideal gas equation.
\begin{equation}
c^2 = \gamma \frac{\pres}{\dens} := Const_{\text{polytrope}} = C_P
\end{equation}
During the numerical simulation this equation of state is enforced via the
\emph{polytropic process} (sometimes called \emph{polytropic cooling}) at
every timestep.
\begin{equation}
\pres = C_P \, \dens^\Gamma,
\end{equation}
where the \emph{polytropic exponent} $\Gamma := 1$ which is equivalent to an
isothermal process. A thorough derivation can be found in \cite{Horedt2004},
p.2-7.

\paragraph{Dimensionless Euler Equations} We want to show that the Euler
equations are invariant to changes of units. This discussion is useful since
most numerical frameworks do not support physical units and rescaled phyiscal
quantities avoid truncation errors due to the limits of floating point
operations. For this, we choose a characteristic length $l_r$, a characteristic
velocity $\vels_r$ and a characterstic density $\dens_r$. Multiplying proper
combinations of these constants with the Euler equations yields
\begin{align}
\left[\partial_t\dens + \nabla \cdot (\dens\,\velv)\right] \cdot \frac{l_r}{\dens_r\,\vels_r} &=  0\\[0.4cm]
\left[\partial_t(\dens\,\velv) + \nabla\cdot(\dens\velv\velv^T) + \nabla \pres - \vec{F}\right] \cdot \frac{l_r}{\dens_r\,\vels_r^2} &= 0\\[0.4cm]
\left[\partial_t \Ener + \nabla \cdot (\velv\,(\ener + \pres))\right] \cdot \frac{l_r}{\dens_r\,\vels_r^3} &=  0
\end{align}
We simplify and get
\begin{align}
\partial_{\tilde{t}} \tilde{\dens} + \tilde{\nabla} \cdot (\tilde{\dens}\,\tilde{\velv})   &=  0\\[0.4cm]
\partial_{\tilde{t}}(\tilde{\dens} \,\tilde{\velv}) +      \tilde{\nabla}\cdot(\tilde{\dens}\tilde{\velv}\tilde{\velv}^T) + \tilde{\nabla} \tilde{\pres} - \tilde{\vec{F}}&= 0\\[0.4cm]
\partial_{\tilde{t}} \tilde{\Ener} + \tilde{\nabla} \cdot (\tilde{\velv}\,(\tilde{\ener} + \tilde{\pres})) &=  0,
\end{align}
where $t_r = \frac{l_r}{\vels_r}$ (characteristic time) and
\begin{equation}
\tilde{t} = \frac{t}{t_r},\ 
\tilde{\dens} = \frac{\dens}{\dens_r},\
\tilde{\velv} = \frac{\velv}{\vels_r},\ 
\tilde{\nabla} = l_r\,\nabla,\ 
\tilde{\Ener} = \frac{\Ener}{\dens_r\,\vels_r^2},\ 
\tilde{\pres} = \frac{\pres}{\dens_r\,\vels_r^2},\ 
\tilde{\vec{F}} = \vec{F} \, \frac{l_r}{\dens_r\,\vels_r^2}.
\end{equation}
Conseqently, the dimensionless Euler equations do not change under unit transformation. If not
stated otherwise we drop the tilde sign ($\tilde{\cdot}$) and assume always
dimensionless quantites from now on.

\paragraph{Choice of parameters} One consequence of dimensionless units is the free
choice of constants. We want to use this feature in choose a sensible set of parameters.
Considering the Euler equation in conservative form \eref{comp-euler}, their functions
of space and time
\begin{equation}
\dens = \dens(t,x,y,z), \;\;(\dens\velv) = (\dens\velv)(t,x,y,z),\;\;\Ener = \Ener(t,x,y,z)
\end{equation}
are faced with
\begin{equation}
\gamma := 5/3,\;\;R := 1, \langle\dens\rangle := 1,\langle\sndsped\rangle := 1,
\end{equation}
where we assume a mono-atomic gas without interacting forces. So we derive
\begin{equation}
C_P = \frac{\sndsped_0^2}{\gamma} = 3/5 = 0.6,\;\;
\langle\pres\rangle = C_P\cdot\langle\dens\rangle = 0.6,\;\;
\langle\Ener\rangle = \frac{\langle\pres\rangle}{\gamma -1} = 0.9,\;\;
\langle\temp\rangle = \frac{\avg{\sndsped}^2}{\gamma\,R} = 0.6
\end{equation}
\remark The average sonic mach number $\Mach$ is consequently equal to the
average root-means-square-velocity (rmsv).
\begin{equation}
\Mach = \frac{\avg{\rmsv}}{\avg{\sndsped}} = \avg{\frac{\int_\Omega \sqrt{\velv^2}}{\int_\Omega \mass}}
\end{equation}

If not state otherwise, these set of constants define the global state at all times.

\subsection{Weak Formulation}
In this section we want to derive the \emph{weak formulation} of the governing
equations. This establishes the basis for the polynomial formulation which is
the core idea of all DG methods.  First, the Euler equations get split up into
terms resembling the independent one temporal and three spatial
dimensions with respect to the linear differential operator.
\begin{equation}
\partial_t \vec{U} + \partial_x\vec{F}(\vec{U})+ \partial_y\vec{G}(\vec{U}) + \partial_z\vec{H}(\vec{U}) + \vec{S} = 0,
\end{equation}
where
\begin{align}
    \vec{U} &= (\dens, \dens\vels_1, \dens\vels_2, \dens\vels_3, \Ener)^T\br
    \vec{F}(\vec{U}) &= (\dens\vels_1, \dens\vels_1^2 + \pres, \dens\vels_1\vels_2, \dens\vels_1\vels_3, \vels_1(\Ener + \pres))^T\br
    \vec{G}(\vec{U}) &= (\dens\vels_2, \dens\vels_2\vels_1, \dens\vels_2^2 + \pres, \dens\vels_2\vels_3, \vels_2(\Ener + \pres))^T\br
    \vec{H}(\vec{U}) &= (\dens\vels_3, \dens\vels_3\vels_1, \dens\vels_3\vels_2, \dens\vels_3^2 + \pres, \vels_3(\Ener + \pres))^T\br
    \vec{S} &= (0,-f_1,-f_2,-f_z,0)^T
\end{align}
Defining a vector-valued test function $\vec{\phi} = (0,..,0,\phi_i,0,...,0)^T$ ($i\in{1,...,5}$), multiplying component-wise
with above equation and integrating over the domain $\Omega$ we get
\begin{equation}
    \int_\Omega \left( \partial_tU_i\,\phi^i 
        + \partial_x F_i(\vec{U})\,\phi^i 
        + \partial_y G_i(\vec{U})\,\phi^i 
        + \partial_z H_i(\vec{U})\,\phi^i + S_i \phi^i \right) d^3x = 0
\end{equation}
Integration-by-parts rearranges the integral into a \emph{source term}, \emph{volume term} and \emph{surface term}.
\begin{align}
    &\int_\Omega \partial_t U_i\,\psi(x,y,z)^i d^3x + \int_\Omega S_i \psi(x,y,z)^i d^3x = \br
        & \int_{\partial\Omega} \left(F_i(\vec{U})\,\psi(x,y,z)^i\,n_x + G_i(\vec{U})\,\psi(x,y,z)^i\,n_z + H_i(\vec{U})\,\psi(x,y,z)^i\,n_z \right) d^2x,\nonumber \br
        -&\int_\Omega \left(F_i(\vec{U})\,\partial_x \psi(x,y,z)^i + G_i(\vec{U})\,\partial_y \psi(x,y,z)^i + H_i(\vec{U})\,\partial_z \psi(x,y,z)^i \right) d^3x
\end{align}

\begin{align}
    &\int_\Omega \partial_t U\,\psi(x,y,z) d^3x + \int_\Omega S \psi(x,y,z) d^3x = \nonumber \br
         &\int_{\partial\Omega} \left[F(\vec{U})\,\psi(x,y,z)\,n_x + G(\vec{U})\,\psi(x,y,z)\,n_z + H(\vec{U})\,\psi(x,y,z)\,n_z \right] d^2x, \br
        -&\int_\Omega \left[F(\vec{U})\,\partial_x \psi(x,y,z) + G(\vec{U})\,\partial_y \psi(x,y,z) + H(\vec{U})\,\partial_z \psi(x,y,z) \right] d^3x
\end{align}





where $\vec{n} = (n_x,n_y,n_z)^T$ is the outward surface normal to $\partial\Omega$.
